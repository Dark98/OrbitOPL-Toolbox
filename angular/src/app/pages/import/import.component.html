<div class="main-section">
  <div
    class="header h-15 flex items-center justify-between px-4 border-b border-base-300"
  >
    <div class="text-4xl">Import Games</div>
  </div>
  @if(_libraryService.hasCurrentDirectory$ | async) {
  <div class="p-4 flex flex-col space-y-4">
    <div class="pt-4 flex justify-start">
      <span class="pr-4 text-sm font-semibold flex flex-col justify-center"
        >Choose the type of gamefile you're trying to import:</span
      >
      <div>
        <input
          type="radio"
          name="radio-gametype"
          class="radio radio-primary"
          (value)="(isGameCd)"
          [disabled]="_libraryService.loading$ | async"
          (change)="isGameCd = true; isGameDvd = false; resetImportState()"
        />
        <span class="pl-2 pr-8">PS1 / POPS (.cue)</span>
        <input
          type="radio"
          name="radio-gametype"
          class="radio radio-primary"
          checked="true"
          [disabled]="_libraryService.loading$ | async"
          (value)="(isGameDvd)"
          (change)="isGameCd = false; isGameDvd = true; resetImportState()"
        /><span class="pl-2 pr-8">PS2 (.iso/.zso)</span>
      </div>
    </div>
    <div>
      <span class="pr-4 text-sm font-semibold flex flex-col justify-center"
        >Select the gamefile to import ({{
          isGameCd ? "point to the .cue file" : ".iso/.zso"
        }}):</span
      >
      <button
        class="btn btn-primary"
        (click)="askForGameFile()"
        [disabled]="_libraryService.loading$ | async"
      >
        Select Gamefile
      </button>
      @if(isGameCd) {
      <div class="text-xs text-gray-500 pt-2">
        PS1/POPS imports use the bundled cue2pops converter when available.
        If it's missing, set <span class="font-mono">POPS_CONVERTER_CMD</span>
        with <span class="font-mono">{{ '{' }}cue{{ '}' }}</span> and
        <span class="font-mono">{{ '{' }}vcd{{ '}' }}</span> placeholders.
      </div>
      @if(bundledCue2PopsChecked && !bundledCue2PopsAvailable) {
      <div
        class="mt-2 text-xs text-yellow-800 bg-yellow-100 border border-yellow-300 rounded p-2"
      >
        Bundled cue2pops converter not found. Set
        <span class="font-mono">POPS_CONVERTER_CMD</span> or place
        <span class="font-mono">cue2pops.exe</span> in
        <span class="font-mono">assets/tools/cue2pops/windows-x64</span>.
      </div>
      }
      }
    </div>
    <div class="pt-8 flex">
      <fieldset class="fieldset mr-4 w-50">
        <legend class="fieldset-legend">GameID</legend>
        <input
          type="text"
          class="input"
          [disabled]="autoDiscoveredId"
          [value]="gameId"
        />
      </fieldset>
      <fieldset class="fieldset w-90">
        <legend class="fieldset-legend">Game Name</legend>
        <input
          type="text"
          class="input"
          [disabled]="autoDiscoveredName"
          [value]="gameName"
        />
      </fieldset>
      <fieldset class="fieldset ml-4 flex-1">
        <legend class="fieldset-legend">Download Artwork</legend>
        <input
          type="checkbox"
          [disabled]="_libraryService.loading$ | async"
          [checked]="downloadArtwork"
          (change)="downloadArtwork = $any($event.target).checked"
          class="toggle"
        />
      </fieldset>
      @if(isGameCd) {
      <fieldset class="fieldset ml-4 flex-1">
        <legend class="fieldset-legend">Update conf_apps.cfg</legend>
        <input
          type="checkbox"
          [disabled]="_libraryService.loading$ | async"
          [checked]="updateConfApps"
          (change)="updateConfApps = $any($event.target).checked"
          class="toggle"
        />
      </fieldset>
      }
    </div>
    <div
      *ngIf="invalidFileDiscovered"
      class="p-4 bg-yellow-100 border border-yellow-300 text-yellow-800 rounded-md"
    >
      <i-lucide
        name="alert-triangle"
        size="16"
        class="inline-block mr-2"
      ></i-lucide>
      <span class="text-sm"
        >The selected file appears to be invalid. Please double-check the file
        and try again.</span
      >
    </div>
    <div>
      <button
        class="btn btn-success"
        (click)="startAutoImportAttempt()"
        [disabled]="
          !gamePath ||
          gamePath.length === 0 ||
          !gameId ||
          gameId.length === 0 ||
          !gameName ||
          gameName.length === 0 ||
          (_libraryService.loading$ | async)
        "
      >
        Start Import
      </button>
    </div>
  </div>
  } @else {
  <div class="p-4">
    <span class="text-sm text-gray-600"
      >Please mount a library directory before attempting to import games.</span
    >
  </div>
  }
</div>
